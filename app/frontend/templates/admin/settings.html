<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n del Sistema - MoirAI</title>
    <link rel="stylesheet" href="/static/css/admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .settings-section {
            background: var(--bg-white);
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .settings-section h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .setting-group {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .setting-info {
            flex: 1;
        }

        .setting-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .setting-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .setting-control {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #ccc;
            border-radius: 24px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--primary-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after {
            transform: translateX(26px);
        }

        .input-field {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: var(--bg-white);
            min-width: 200px;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(115, 15, 51, 0.1);
        }

        .select-field {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: var(--bg-white);
            min-width: 200px;
        }

        .btn-save {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .system-settings, .config-options {
            /* IDs esperados por los scripts de demo - no necesitan estilos espec√≠ficos */
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-healthy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .config-summary {
            background: var(--bg-lighter);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .config-summary h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .config-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .setting-control {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo"><i class="fas fa-brain"></i> <span>MoirAI Admin</span></div>
        </div>
        <nav class="sidebar-nav"></nav>
        <div class="sidebar-footer">
            <a href="/" class="nav-item"><i class="fas fa-sign-out-alt"></i> <span>Volver al sitio</span></a>
        </div>
    </aside>

    <!-- Navbar Container for Demo Navigation -->
    <div id="navbar-container"></div>

    <main class="main-content">
        <header class="top-nav">
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Buscar configuraciones...">
            </div>
            <div class="top-nav-right">
                <button class="icon-btn"><i class="fas fa-bell"></i></button>
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name">Admin</div>
                        <div class="user-role">Administrador</div>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-section active">
            <div class="section-header">
                <h1><i class="fas fa-cog"></i> Configuraci√≥n del Sistema</h1>
                <div class="header-actions">
                    <button class="btn-save" onclick="saveSettings()" id="save-btn">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </div>
            </div>

            <div id="error-message" class="error-message" style="display: none;"></div>
            <div id="success-message" class="success-message" style="display: none;"></div>

            <div class="settings-grid">
                <!-- Configuraci√≥n del Sistema -->
                <div class="settings-section system-settings">
                    <h3><i class="fas fa-server"></i> Configuraci√≥n del Sistema</h3>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Modo Mantenimiento</div>
                                <div class="setting-description">Activar modo mantenimiento para actualizaciones</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch" id="maintenance-toggle" onclick="toggleSetting('maintenance')"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Registro de Usuarios</div>
                                <div class="setting-description">Permitir registro de nuevos usuarios</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" id="registration-toggle" onclick="toggleSetting('registration')"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auditor√≠a de Acciones</div>
                                <div class="setting-description">Registrar todas las acciones de usuarios</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" id="audit-toggle" onclick="toggleSetting('audit')"></div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">L√≠mite de Rate Limit</div>
                                <div class="setting-description">Solicitudes por minuto por usuario</div>
                            </div>
                            <div class="setting-control">
                                <input type="number" class="input-field" id="rate-limit-input" value="100" min="10" max="1000">
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Retenci√≥n de Datos (d√≠as)</div>
                                <div class="setting-description">D√≠as para mantener datos inactivos</div>
                            </div>
                            <div class="setting-control">
                                <input type="number" class="input-field" id="retention-input" value="365" min="30" max="3650">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Opciones de Configuraci√≥n -->
                <div class="settings-section config-options">
                    <h3><i class="fas fa-sliders-h"></i> Opciones de Configuraci√≥n</h3>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Notificaciones por Email</div>
                                <div class="setting-description">Enviar notificaciones autom√°ticas</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" id="email-toggle" onclick="toggleSetting('email')"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">An√°lisis de CV Autom√°tico</div>
                                <div class="setting-description">Procesar CVs autom√°ticamente al subir</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" id="cv-analysis-toggle" onclick="toggleSetting('cv-analysis')"></div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Matching Inteligente</div>
                                <div class="setting-description">Usar IA para matching de candidatos</div>
                            </div>
                            <div class="setting-control">
                                <div class="toggle-switch active" id="matching-toggle" onclick="toggleSetting('matching')"></div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Idioma Predeterminado</div>
                                <div class="setting-description">Idioma de la interfaz de usuario</div>
                            </div>
                            <div class="setting-control">
                                <select class="select-field" id="language-select">
                                    <option value="es">Espa√±ol</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Zona Horaria</div>
                                <div class="setting-description">Zona horaria del sistema</div>
                            </div>
                            <div class="setting-control">
                                <select class="select-field" id="timezone-select">
                                    <option value="America/Mexico_City">M√©xico (CDMX)</option>
                                    <option value="America/Buenos_Aires">Argentina (Buenos Aires)</option>
                                    <option value="Europe/Madrid">Espa√±a (Madrid)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estado del Sistema -->
            <div class="settings-section">
                <h3><i class="fas fa-heartbeat"></i> Estado del Sistema</h3>

                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Base de Datos</h3>
                            <div class="kpi-icon"><i class="fas fa-database"></i></div>
                        </div>
                        <div class="kpi-value">
                            <span class="status-indicator status-healthy">
                                <i class="fas fa-check-circle"></i> Saludable
                            </span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>API Services</h3>
                            <div class="kpi-icon"><i class="fas fa-server"></i></div>
                        </div>
                        <div class="kpi-value">
                            <span class="status-indicator status-healthy">
                                <i class="fas fa-check-circle"></i> Operativo
                            </span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Espacio en Disco</h3>
                            <div class="kpi-icon"><i class="fas fa-hdd"></i></div>
                        </div>
                        <div class="kpi-value">
                            <span class="status-indicator status-healthy">
                                <i class="fas fa-check-circle"></i> 85% Libre
                            </span>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>√öltima Copia</h3>
                            <div class="kpi-icon"><i class="fas fa-shield-alt"></i></div>
                        </div>
                        <div class="kpi-value">
                            <span class="status-indicator status-healthy">
                                <i class="fas fa-clock"></i> Hoy 02:00
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen de Configuraci√≥n -->
            <div class="config-summary">
                <h4><i class="fas fa-info-circle"></i> Resumen de Configuraci√≥n Actual</h4>
                <div id="config-summary-content">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let settings = {};

        function getApiKey() {
            const key = localStorage.getItem('api_key');
            if (!key) {
                showError('Sin sesi√≥n activa');
                setTimeout(() => window.location.href = '/login', 2000);
            }
            return key;
        }

        function showError(msg) {
            const el = document.getElementById('error-message');
            el.textContent = msg;
            el.style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
        }

        function showSuccess(msg) {
            const el = document.getElementById('success-message');
            el.textContent = msg;
            el.style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
        }

        function toggleSetting(setting) {
            const toggle = document.getElementById(`${setting}-toggle`);
            toggle.classList.toggle('active');
            settings[setting] = toggle.classList.contains('active');
            updateConfigSummary();
        }

        function loadSettings() {
            // Simular carga de configuraciones desde API
            settings = {
                maintenance: false,
                registration: true,
                audit: true,
                email: true,
                'cv-analysis': true,
                matching: true,
                language: 'es',
                timezone: 'America/Mexico_City',
                'rate-limit': 100,
                retention: 365
            };

            // Aplicar configuraciones a la UI
            Object.keys(settings).forEach(key => {
                if (typeof settings[key] === 'boolean') {
                    const toggle = document.getElementById(`${key}-toggle`);
                    if (toggle) {
                        if (settings[key]) {
                            toggle.classList.add('active');
                        } else {
                            toggle.classList.remove('active');
                        }
                    }
                } else {
                    const input = document.getElementById(`${key}-input`) || document.getElementById(`${key}-select`);
                    if (input) {
                        input.value = settings[key];
                    }
                }
            });

            updateConfigSummary();
        }

        function updateConfigSummary() {
            const summary = document.getElementById('config-summary-content');
            const items = [
                { label: 'Modo Mantenimiento', value: settings.maintenance ? 'Activado' : 'Desactivado' },
                { label: 'Registro de Usuarios', value: settings.registration ? 'Permitido' : 'Bloqueado' },
                { label: 'Auditor√≠a', value: settings.audit ? 'Activada' : 'Desactivada' },
                { label: 'Notificaciones Email', value: settings.email ? 'Activadas' : 'Desactivadas' },
                { label: 'An√°lisis CV', value: settings['cv-analysis'] ? 'Autom√°tico' : 'Manual' },
                { label: 'Matching IA', value: settings.matching ? 'Activado' : 'Desactivado' },
                { label: 'Idioma', value: settings.language === 'es' ? 'Espa√±ol' : 'English' },
                { label: 'Zona Horaria', value: settings.timezone.replace('_', ' ') },
                { label: 'Rate Limit', value: `${settings['rate-limit']} req/min` },
                { label: 'Retenci√≥n Datos', value: `${settings.retention} d√≠as` }
            ];

            summary.innerHTML = items.map(item => `
                <div class="config-item">
                    <span>${item.label}</span>
                    <strong>${item.value}</strong>
                </div>
            `).join('');
        }

        async function saveSettings() {
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerHTML;

            try {
                hideMessages();
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

                // Recopilar valores actuales
                settings['rate-limit'] = parseInt(document.getElementById('rate-limit-input').value);
                settings.retention = parseInt(document.getElementById('retention-input').value);
                settings.language = document.getElementById('language-select').value;
                settings.timezone = document.getElementById('timezone-select').value;

                // Simular guardado (en producci√≥n har√≠a una llamada API)
                await new Promise(resolve => setTimeout(resolve, 1500));

                showSuccess('Configuraci√≥n guardada exitosamente');
                saveBtn.innerHTML = '<i class="fas fa-check"></i> ¬°Guardado!';

                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }, 2000);

            } catch (error) {
                showError('Error al guardar la configuraci√≥n');
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
        });
    </script>

    <!-- Config -->
    <script>
        // ‚úÖ CORRECCI√ìN: Detectar din√°micamente la URL base desde el navegador
        const protocol = window.location.protocol
        const hostname = window.location.hostname
        const port = window.location.port
        const origin = port ? `${protocol}//${hostname}:${port}` : `${protocol}//${hostname}`
        window.API_BASE_URL = `${origin}/api/v1`
        console.log('üîó API Base URL:', window.API_BASE_URL)
    </script>

    <!-- Scripts -->
    <script src="/static/js/navbar-manager.js"></script>
</body>
</html>
